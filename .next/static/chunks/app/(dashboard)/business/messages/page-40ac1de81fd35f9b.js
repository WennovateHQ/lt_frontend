(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2948],{43998:function(e,s,o){Promise.resolve().then(o.bind(o,51287))},51287:function(e,s,o){"use strict";o.r(s),o.d(s,{default:function(){return d}});var n=o(57437),a=o(53689),t=o(269),r=o(2265),l=o(45710),i=o(99376),c=o(34980);function d(){let{user:e}=(0,l.a)(),s=(0,i.useSearchParams)(),[o,d]=(0,r.useState)(null),[u,v]=(0,r.useState)([]),[g,D]=(0,r.useState)([]),[f,h]=(0,r.useState)(!0),[m,x]=(0,r.useState)(null),[y,C]=(0,r.useState)(!1),b=s.get("talentId"),p=s.get("applicationId"),w=s.get("conversationId");(0,r.useEffect)(()=>{j()},[]),(0,r.useEffect)(()=>{o&&N(o)},[o]),(0,r.useEffect)(()=>{w&&u.length>0&&(u.find(e=>e.id===w),d(w))},[w,u]),(0,r.useEffect)(()=>{if(b&&p&&u.length>0&&!y){let e=u.find(e=>{var s;return null===(s=e.participantUsers)||void 0===s?void 0:s.some(e=>e.id===b)});e?(console.log("\uD83D\uDCCD Found existing conversation:",e.id),d(e.id)):(console.log("\uD83D\uDCCD No existing conversation found, creating new one"),C(!0),E(b,p))}},[b,p,u,y]);let j=async()=>{try{h(!0),x(null);let e=await c.Y.getConversations();console.log("✅ Conversations loaded successfully:",e.conversations.length),v(e.conversations)}catch(s){var e;console.error("❌ Failed to load conversations:",s),console.error("Error details:",(null===(e=s.response)||void 0===e?void 0:e.data)||s.message),x("Failed to load conversations"),v([])}finally{h(!1)}},N=async e=>{try{console.log("\uD83D\uDD0D Loading messages for conversation:",e);let s=await c.Y.getMessages({conversationId:e});console.log("\uD83D\uDCE8 Messages response:",s),console.log("\uD83D\uDCE8 Messages array:",s.messages),D(s.messages)}catch(e){console.error("Failed to load messages:",e),D([])}},E=async(s,o)=>{try{console.log("\uD83D\uDD04 Creating conversation with talent:",s);let n=await c.Y.findOrCreateConversation([e.id,s],o);console.log("✅ Conversation created:",n.id),d(n.id),await j()}catch(e){var n;console.error("❌ Failed to create conversation:",e),console.error("Error details:",(null===(n=e.response)||void 0===n?void 0:n.data)||e.message),alert("Could not start conversation with this talent. They may not have an account yet.")}},S=u.find(e=>e.id===o)||null,k=g.filter(e=>e.conversationId===o);console.log("\uD83D\uDD0D Debug - selectedConversationId:",o),console.log("\uD83D\uDD0D Debug - all messages:",g),console.log("\uD83D\uDD0D Debug - filtered conversationMessages:",k);let I=async(e,s)=>{if(o)try{await c.Y.sendMessage(o,{content:e,attachments:s}),N(o)}catch(e){console.error("Failed to send message:",e)}},F=async e=>{if(o)try{await c.Y.markAsRead(o,e)}catch(e){console.error("Failed to mark as read:",e)}};return f?(0,n.jsx)("div",{className:"flex items-center justify-center h-[calc(100vh-10rem)]",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):m?(0,n.jsx)("div",{className:"flex items-center justify-center h-[calc(100vh-10rem)]",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-red-600 mb-4",children:m}),(0,n.jsx)("button",{onClick:j,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Retry"})]})}):(0,n.jsxs)("div",{className:"h-[calc(100vh-10rem)] flex",children:[(0,n.jsx)("div",{className:"w-1/3 border-r border-gray-200",children:(0,n.jsx)(a.p,{conversations:u,selectedConversationId:o||void 0,onConversationSelect:d,currentUserId:(null==e?void 0:e.id)||""})}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(t.z,{conversation:S,messages:k,currentUserId:(null==e?void 0:e.id)||"",onSendMessage:I,onMarkAsRead:F})})]})}}},function(e){e.O(0,[6137,3464,5710,7922,2971,2117,1744],function(){return e(e.s=43998)}),_N_E=e.O()}]);