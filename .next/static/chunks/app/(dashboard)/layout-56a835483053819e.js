(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5642],{12730:function(e,a,s){Promise.resolve().then(s.bind(s,77699))},77699:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return I}});var t=s(57437),l=s(2265),n=s(27648),i=s(33145),r=s(99376),c=s(45710),o=s(19778),d=s(13363),x=s(19672),m=s(43767),h=s(38081),f=s(338),u=s(68690),g=s(47842),p=s(16331),N=s(79785),j=s(77165),b=s(4355),v=s(16503),y=s(93448),w=s(23121),E=s(87233),D=s(64081),C=s(26305),Z=s(85010);function k(){let[e,a]=(0,l.useState)(!1),[s,n]=(0,l.useState)([]),[i,r]=(0,l.useState)(0),[c,o]=(0,l.useState)(!1);(0,l.useEffect)(()=>{d();let e=setInterval(d,3e4);return()=>clearInterval(e)},[]),(0,l.useEffect)(()=>{e&&x()},[e]);let d=async()=>{try{let e=await C.apiClient.get("/notifications/unread-count");r(e.count||0)}catch(e){console.error("Failed to fetch unread count:",e),r(0)}},x=async()=>{try{o(!0);let e=await C.apiClient.get("/notifications");n(e.notifications||[])}catch(e){console.error("Failed to fetch notifications:",e),n([])}finally{o(!1)}},m=async e=>{try{await C.apiClient.put("/notifications/".concat(e,"/read")),n(s.map(a=>a.id===e?{...a,read:!0}:a)),r(Math.max(0,i-1))}catch(e){console.error("Failed to mark as read:",e)}},h=async()=>{try{await C.apiClient.put("/notifications/mark-all-read"),n(s.map(e=>({...e,read:!0}))),r(0)}catch(e){console.error("Failed to mark all as read:",e)}},f=async e=>{try{var a;await C.apiClient.delete("/notifications/".concat(e)),n(s.filter(a=>a.id!==e)),(null===(a=s.find(a=>a.id===e))||void 0===a?void 0:a.read)||r(Math.max(0,i-1))}catch(e){console.error("Failed to delete notification:",e)}},u=e=>{switch(e){case"ESCROW_FUNDED":case"PAYMENT_RECEIVED":return"\uD83D\uDCB0";case"STRIPE_SETUP_REQUIRED":return"⚠️";case"MILESTONE_SUBMITTED":return"\uD83D\uDCCB";case"MILESTONE_APPROVED":return"✅";case"MILESTONE_REJECTED":return"❌";case"PAYMENT_RELEASED":return"\uD83D\uDCB5";default:return"\uD83D\uDD14"}};return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("button",{onClick:()=>a(!e),className:"relative p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Notifications",children:[i>0?(0,t.jsx)(D.Z,{className:"h-6 w-6 text-blue-600"}):(0,t.jsx)(w.Z,{className:"h-6 w-6"}),i>0&&(0,t.jsx)("span",{className:"absolute top-0 right-0 flex items-center justify-center min-w-[20px] h-5 px-1 text-xs font-bold text-white bg-red-500 rounded-full",children:i>99?"99+":i})]}),e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>a(!1)}),(0,t.jsxs)("div",{className:"absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-2xl border border-gray-200 z-50 max-h-[600px] overflow-hidden flex flex-col",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between bg-gray-50",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Notifications"}),i>0&&(0,t.jsx)("button",{onClick:h,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Mark all as read"})]}),(0,t.jsx)("div",{className:"overflow-y-auto flex-1",children:c?(0,t.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-2",children:"Loading..."})]}):0===s.length?(0,t.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,t.jsx)(w.Z,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),(0,t.jsx)("p",{children:"No notifications"})]}):(0,t.jsx)("div",{className:"divide-y divide-gray-100",children:s.map(e=>(0,t.jsx)("div",{className:"p-4 hover:bg-gray-50 transition-colors ".concat(e.read?"":"bg-blue-50"),children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0 text-2xl",children:u(e.type)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-gray-900",children:e.title}),(0,t.jsx)("button",{onClick:()=>f(e.id),className:"flex-shrink-0 p-1 text-gray-400 hover:text-gray-600 rounded",children:(0,t.jsx)(j.Z,{className:"h-4 w-4"})})]}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-600 line-clamp-2",children:e.message}),(0,t.jsxs)("div",{className:"mt-2 flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-xs text-gray-500",children:(0,Z.Q)(new Date(e.createdAt),{addSuffix:!0})}),!e.read&&(0,t.jsxs)("button",{onClick:()=>m(e.id),className:"text-xs text-blue-600 hover:text-blue-700 font-medium flex items-center gap-1",children:[(0,t.jsx)(E.Z,{className:"h-3 w-3"}),"Mark as read"]})]})]})]})},e.id))})}),s.length>0&&(0,t.jsx)("div",{className:"p-3 border-t border-gray-200 bg-gray-50 text-center",children:(0,t.jsx)("button",{onClick:()=>{a(!1)},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View all notifications"})})]})]})]})}let T=[{name:"Dashboard",href:"/business",icon:o.Z},{name:"Projects",href:"/business/projects",icon:d.Z},{name:"Applications",href:"/business/applications",icon:x.Z},{name:"Messages",href:"/business/messages",icon:m.Z},{name:"Contracts",href:"/business/contracts",icon:x.Z},{name:"Payments",href:"/business/payments",icon:h.Z}],S=[{name:"Dashboard",href:"/talent",icon:o.Z},{name:"Opportunities",href:"/talent/opportunities",icon:d.Z},{name:"Applications",href:"/talent/applications",icon:x.Z},{name:"Messages",href:"/talent/messages",icon:m.Z},{name:"Contracts",href:"/talent/contracts",icon:x.Z},{name:"Payments",href:"/talent/payments",icon:h.Z},{name:"Profile",href:"/talent/profile",icon:f.Z}],M=[{name:"Dashboard",href:"/admin",icon:o.Z},{name:"Users",href:"/admin/users",icon:f.Z},{name:"Projects",href:"/admin/projects",icon:d.Z},{name:"Escrow",href:"/admin/escrow",icon:u.Z},{name:"Disputes",href:"/admin/disputes",icon:g.Z},{name:"Analytics",href:"/admin/analytics",icon:p.Z},{name:"Payments",href:"/admin/payments",icon:h.Z},{name:"Files",href:"/admin/files",icon:N.Z}];function I(e){var a,s,o,d;let{children:x}=e,[m,h]=(0,l.useState)(!1),{user:u,logout:g,loading:p}=(0,c.a)(),N=(0,r.usePathname)(),w=(0,r.useRouter)();if((0,l.useEffect)(()=>{p||u||w.push("/login")},[u,p,w]),p)return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})});if(!u)return null;let E=null==u?void 0:null===(a=u.userType)||void 0===a?void 0:a.toLowerCase(),D="business"===E?T:"admin"===E?M:S;return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[m&&(0,t.jsxs)("div",{className:"relative z-50 lg:hidden",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-gray-900/80",onClick:()=>h(!1)}),(0,t.jsx)("div",{className:"fixed inset-0 flex",children:(0,t.jsxs)("div",{className:"relative mr-16 flex w-full max-w-xs flex-1",children:[(0,t.jsx)("div",{className:"absolute left-full top-0 flex w-16 justify-center pt-5",children:(0,t.jsx)("button",{type:"button",className:"-m-2.5 p-2.5",onClick:()=>h(!1),children:(0,t.jsx)(j.Z,{className:"h-6 w-6 text-white"})})}),(0,t.jsxs)("div",{className:"flex grow flex-col gap-y-5 overflow-y-auto bg-white px-6 pb-2",children:[(0,t.jsx)("div",{className:"flex h-16 shrink-0 items-center",children:(0,t.jsx)(n.default,{href:"/",className:"flex items-center space-x-2",children:(0,t.jsx)(i.default,{className:"h-16 w-auto",src:"/logo.png",alt:"LocalTalents.ca",width:240,height:240})})}),(0,t.jsx)("nav",{className:"flex flex-1 flex-col",children:(0,t.jsx)("ul",{role:"list",className:"flex flex-1 flex-col gap-y-7",children:(0,t.jsx)("li",{children:(0,t.jsx)("ul",{role:"list",className:"-mx-2 space-y-1",children:D.map(e=>(0,t.jsx)("li",{children:(0,t.jsxs)(n.default,{href:e.href,className:(0,y.cn)(N===e.href?"bg-gray-50 text-blue-600":"text-gray-700 hover:text-blue-600 hover:bg-gray-50","group flex gap-x-3 rounded-md p-2 text-sm leading-6 font-semibold"),children:[(0,t.jsx)(e.icon,{className:"h-6 w-6 shrink-0"}),e.name]})},e.name))})})})})]})]})})]}),(0,t.jsx)("div",{className:"hidden lg:fixed lg:inset-y-0 lg:z-50 lg:flex lg:w-72 lg:flex-col",children:(0,t.jsxs)("div",{className:"flex grow flex-col gap-y-5 overflow-y-auto border-r border-gray-200 bg-white px-6",children:[(0,t.jsx)("div",{className:"flex h-16 shrink-0 items-center",children:(0,t.jsx)(n.default,{href:"/",className:"flex items-center space-x-2",children:(0,t.jsx)(i.default,{className:"h-16 w-auto",src:"/logo.png",alt:"LocalTalents.ca",width:240,height:240})})}),(0,t.jsx)("nav",{className:"flex flex-1 flex-col",children:(0,t.jsxs)("ul",{role:"list",className:"flex flex-1 flex-col gap-y-7",children:[(0,t.jsx)("li",{children:(0,t.jsx)("ul",{role:"list",className:"-mx-2 space-y-1",children:D.map(e=>(0,t.jsx)("li",{children:(0,t.jsxs)(n.default,{href:e.href,className:(0,y.cn)(N===e.href?"bg-gray-50 text-blue-600":"text-gray-700 hover:text-blue-600 hover:bg-gray-50","group flex gap-x-3 rounded-md p-2 text-sm leading-6 font-semibold"),children:[(0,t.jsx)(e.icon,{className:"h-6 w-6 shrink-0"}),e.name]})},e.name))})}),(0,t.jsx)("li",{className:"-mx-6 mt-auto",children:(0,t.jsxs)("div",{className:"flex items-center gap-x-4 px-6 py-3 text-sm font-semibold leading-6 text-gray-900",children:[(null==u?void 0:null===(s=u.profile)||void 0===s?void 0:s.avatar)?(0,t.jsx)(i.default,{src:u.profile.avatar,alt:"".concat(u.profile.firstName," ").concat(u.profile.lastName),width:32,height:32,className:"h-8 w-8 rounded-full object-cover"}):(0,t.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-50 flex items-center justify-center",children:(0,t.jsx)(f.Z,{className:"h-5 w-5 text-gray-400"})}),(0,t.jsx)("span",{className:"sr-only",children:"Your profile"}),(0,t.jsxs)("span",{"aria-hidden":"true",children:[null==u?void 0:null===(o=u.profile)||void 0===o?void 0:o.firstName," ",null==u?void 0:null===(d=u.profile)||void 0===d?void 0:d.lastName]})]})})]})})]})}),(0,t.jsxs)("div",{className:"lg:pl-72",children:[(0,t.jsxs)("div",{className:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8",children:[(0,t.jsx)("button",{type:"button",className:"-m-2.5 p-2.5 text-gray-700 lg:hidden",onClick:()=>h(!0),children:(0,t.jsx)(b.Z,{className:"h-6 w-6"})}),(0,t.jsx)("div",{className:"h-6 w-px bg-gray-200 lg:hidden"}),(0,t.jsxs)("div",{className:"flex flex-1 gap-x-4 self-stretch lg:gap-x-6",children:[(0,t.jsx)("div",{className:"flex items-center gap-x-4 lg:gap-x-6"}),(0,t.jsxs)("div",{className:"flex items-center gap-x-4 lg:gap-x-6 ml-auto",children:[(0,t.jsx)(k,{}),(0,t.jsx)("div",{className:"hidden lg:block lg:h-6 lg:w-px lg:bg-gray-200"}),(0,t.jsx)("button",{onClick:g,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Sign out",title:"Sign out",children:(0,t.jsx)(v.Z,{className:"h-6 w-6"})})]})]})]}),(0,t.jsx)("main",{className:"py-10",children:(0,t.jsx)("div",{className:"px-4 sm:px-6 lg:px-8",children:x})})]})]})}},93448:function(e,a,s){"use strict";s.d(a,{SY:function(){return c},cn:function(){return n},p6:function(){return r},xG:function(){return i}});var t=s(61994),l=s(53335);function n(){for(var e=arguments.length,a=Array(e),s=0;s<e;s++)a[s]=arguments[s];return(0,l.m6)((0,t.W)(a))}function i(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CAD";return new Intl.NumberFormat("en-CA",{style:"currency",currency:a}).format(e)}function r(e){if(!e)return"Invalid date";let a=new Date(e);return isNaN(a.getTime())?"Invalid date":new Intl.DateTimeFormat("en-CA",{year:"numeric",month:"long",day:"numeric"}).format(a)}function c(e){if(!e)return"Invalid date";let a=new Date,s=new Date(e);if(isNaN(s.getTime()))return"Invalid date";let t=Math.floor((a.getTime()-s.getTime())/1e3);return t<60?"just now":t<3600?"".concat(Math.floor(t/60),"m ago"):t<86400?"".concat(Math.floor(t/3600),"h ago"):t<2592e3?"".concat(Math.floor(t/86400),"d ago"):r(e)}}},function(e){e.O(0,[6137,3464,2972,5878,2678,5710,2971,2117,1744],function(){return e(e.s=12730)}),_N_E=e.O()}]);