(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1522,6305],{24654:function(){},72938:function(e,s,t){Promise.resolve().then(t.bind(t,33415))},33415:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return ed},dynamic:function(){return en}});var a=t(57437),l=t(2265),i=t(79820),r=t(12381),n=t(40279),c=t(69174),d=t(17168),o=t(32060),m=t(41463),x=t(20322),h=t(1442),u=t(47842),p=t(68690),j=t(41556),g=t(40178),N=t(7204),v=t(95937),b=t(55026),f=t(38081),y=t(19672),w=t(11713),A=t(29827),C=t(21770);function Z(e){return Math.round(8*e)/100}function _(e){return Math.round((.029*e+.3)*100)/100}t(38169),t(40257);var D=t(3227);function I(){let e=(0,A.NL)();return(0,C.D)({mutationFn:async e=>(await D.x.post("/escrow/".concat(e.escrowId,"/milestones/").concat(e.milestoneId,"/submit"),{deliverables:e.deliverables,notes:e.notes})).data,onSuccess:(s,t)=>{e.invalidateQueries({queryKey:["escrow",t.escrowId]})}})}var S=t(23675),P=t(30036),k=t(16546),z=t(41077),F=t(42548),T=t(77165),R=t(43767),q=t(93448),M=t(29501),O=t(13590),Y=t(67119),U=t(74291),E=t(75060),G=t(43836);let L=Y.Ry({title:Y.Z_().min(1,"Title is required"),description:Y.Z_().min(10,"Description must be at least 10 characters"),fileUrl:Y.Z_().url().optional(),fileName:Y.Z_().optional(),fileSize:Y.Rx().optional()}),V=Y.Ry({deliverables:Y.IX(L).min(1,"At least one deliverable is required"),notes:Y.Z_().optional()});function X(e){var s;let{escrowId:t,milestone:c,onClose:d}=e,[o,m]=(0,l.useState)([]),x=I(),{register:p,handleSubmit:j,watch:g,setValue:N,formState:{errors:b,isSubmitting:f}}=(0,M.cI)({resolver:(0,O.F)(V),defaultValues:{deliverables:c.deliverables.length>0?c.deliverables.map(e=>({title:e.title,description:e.description,fileUrl:e.fileUrl,fileName:e.fileName,fileSize:e.fileSize})):[{title:"",description:"",fileUrl:"",fileName:"",fileSize:0}],notes:c.notes||""}}),y=g("deliverables"),w=e=>{N("deliverables",g("deliverables").filter((s,t)=>t!==e))},A=async(e,s)=>{let t="deliverable-".concat(e);m(e=>[...e,t]);try{await new Promise(e=>setTimeout(e,2e3));let t="https://storage.example.com/files/".concat(s.name),a=[...g("deliverables")];a[e]={...a[e],fileUrl:t,fileName:s.name,fileSize:s.size},N("deliverables",a)}catch(e){console.error("File upload failed:",e)}finally{m(e=>e.filter(e=>e!==t))}},C=async e=>{try{await x.mutateAsync({escrowId:t,milestoneId:c.id,deliverables:e.deliverables.map(e=>({title:e.title,description:e.description,fileUrl:e.fileUrl,fileName:e.fileName,fileSize:e.fileSize})),notes:e.notes}),d()}catch(e){console.error("Failed to submit milestone:",e)}},Z=c.deliverables.some(e=>"rejected"===e.status);return(0,a.jsx)(U.Vq,{open:!0,onOpenChange:d,children:(0,a.jsxs)(U.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(U.fK,{children:[(0,a.jsxs)(U.$N,{className:"flex items-center gap-2",children:[(0,a.jsx)(P.Z,{className:"w-5 h-5"}),Z?"Resubmit":"Submit"," Milestone: ",c.title]}),(0,a.jsx)(U.Be,{children:"Submit your completed work for milestone approval. Include all required deliverables and documentation."})]}),(0,a.jsxs)("form",{onSubmit:j(C),className:"space-y-6",children:[(0,a.jsx)(i.Zb,{children:(0,a.jsxs)(i.aY,{className:"pt-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{className:"text-sm font-medium text-gray-600",children:"Amount"}),(0,a.jsx)("p",{className:"text-lg font-semibold",children:(0,q.xG)(c.amount)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{className:"text-sm font-medium text-gray-600",children:"Percentage"}),(0,a.jsxs)("p",{className:"text-lg font-semibold",children:[c.percentage,"%"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{className:"text-sm font-medium text-gray-600",children:"Status"}),(0,a.jsx)("p",{className:"text-lg font-semibold capitalize",children:c.status.replace("_"," ")})]})]}),c.approvalRequirements.length>0&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)(E._,{className:"text-sm font-medium text-gray-900",children:"Approval Requirements"}),(0,a.jsx)("ul",{className:"mt-2 list-disc list-inside space-y-1",children:c.approvalRequirements.map((e,s)=>(0,a.jsx)("li",{className:"text-sm text-gray-600",children:e},s))})]})]})}),Z&&(0,a.jsxs)(v.bZ,{className:"border-yellow-200 bg-yellow-50",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 text-yellow-600"}),(0,a.jsx)(v.X,{className:"text-yellow-800",children:"This milestone was previously rejected. Please address the feedback and resubmit with the requested changes."})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(E._,{className:"text-base font-semibold",children:"Deliverables"}),(0,a.jsxs)(r.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{N("deliverables",[...g("deliverables"),{title:"",description:"",fileUrl:"",fileName:"",fileSize:0}])},children:[(0,a.jsx)(G.Z,{className:"w-4 h-4 mr-2"}),"Add Deliverable"]})]}),y.map((e,s)=>{var t,l,c,d,m,x,u,j;let v=o.includes("deliverable-".concat(s));return(0,a.jsx)(i.Zb,{className:"relative",children:(0,a.jsxs)(i.aY,{className:"pt-6",children:[y.length>1&&(0,a.jsx)(r.z,{type:"button",variant:"ghost",size:"sm",className:"absolute top-2 right-2",onClick:()=>w(s),children:(0,a.jsx)(T.Z,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{htmlFor:"deliverables.".concat(s,".title"),children:"Title *"}),(0,a.jsx)(n.I,{...p("deliverables.".concat(s,".title")),placeholder:"e.g., Website Design Mockups"}),(null===(l=b.deliverables)||void 0===l?void 0:null===(t=l[s])||void 0===t?void 0:t.title)&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:null===(d=b.deliverables[s])||void 0===d?void 0:null===(c=d.title)||void 0===c?void 0:c.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{htmlFor:"deliverables.".concat(s,".description"),children:"Description *"}),(0,a.jsx)(S.g,{...p("deliverables.".concat(s,".description")),placeholder:"Describe what you're delivering and how it meets the requirements...",rows:3}),(null===(x=b.deliverables)||void 0===x?void 0:null===(m=x[s])||void 0===m?void 0:m.description)&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:null===(j=b.deliverables[s])||void 0===j?void 0:null===(u=j.description)||void 0===u?void 0:u.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{children:"File Upload"}),(0,a.jsx)("div",{className:"mt-2",children:e.fileName?(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 text-green-600"}),(0,a.jsx)("span",{className:"text-sm font-medium text-green-800",children:e.fileName}),e.fileSize&&(0,a.jsxs)("span",{className:"text-xs text-green-600",children:["(",Math.round(e.fileSize/1024)," KB)"]})]}),(0,a.jsx)(r.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>{let e=[...g("deliverables")];e[s]={...e[s],fileUrl:"",fileName:"",fileSize:0},N("deliverables",e)},children:(0,a.jsx)(T.Z,{className:"w-4 h-4"})})]}):(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[(0,a.jsx)(P.Z,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:v?"Uploading...":"Upload your file"}),(0,a.jsx)("input",{type:"file",className:"hidden",id:"file-".concat(s),onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&A(s,a)},disabled:v}),(0,a.jsx)(r.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{var e;return null===(e=document.getElementById("file-".concat(s)))||void 0===e?void 0:e.click()},disabled:v,children:v?"Uploading...":"Choose File"})]})})]})]})]})},s)}),(null===(s=b.deliverables)||void 0===s?void 0:s.root)&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:b.deliverables.root.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{htmlFor:"notes",children:"Additional Notes"}),(0,a.jsx)(S.g,{...p("notes"),placeholder:"Any additional information or context for this submission...",rows:3})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3 pt-6 border-t",children:[(0,a.jsx)(r.z,{type:"button",variant:"outline",onClick:d,children:"Cancel"}),(0,a.jsx)(r.z,{type:"submit",disabled:f||x.isPending||o.length>0,children:f||x.isPending?"Submitting...":Z?"Resubmit Milestone":"Submit Milestone"})]})]})]})})}function B(e){let{milestone:s,milestoneNumber:t,userRole:n,userId:d,escrowId:o,onDispute:m}=e,[p,j]=(0,l.useState)(!1),[g,N]=(0,l.useState)(!1),[b,f]=(0,l.useState)(!1),[y,w]=(0,l.useState)(""),[Z,_]=(0,l.useState)(""),[M,O]=(0,l.useState)(""),Y=function(e){let s="pending"===e.status||"in_progress"===e.status,t="submitted"===e.status,a="submitted"===e.status,l="submitted"===e.status||"approved"===e.status;return{canSubmit:s,canApprove:t,canReject:a,canDispute:l,isCompleted:"released"===e.status,isDisputed:"disputed"===e.status,needsResubmission:"in_progress"===e.status&&e.deliverables.some(e=>"rejected"===e.status),status:e.status}}(s);I();let U=function(){let e=(0,A.NL)();return(0,C.D)({mutationFn:async e=>(await D.x.post("/escrow/".concat(e.escrowId,"/milestones/").concat(e.milestoneId,"/approve"),{approvalNotes:e.approvalNotes})).data,onSuccess:(s,t)=>{e.invalidateQueries({queryKey:["escrow",t.escrowId]}),e.invalidateQueries({queryKey:["transactions"]})}})}(),E=function(){let e=(0,A.NL)();return(0,C.D)({mutationFn:async e=>(await D.x.post("/escrow/".concat(e.escrowId,"/milestones/").concat(e.milestoneId,"/reject"),{rejectionReason:e.rejectionReason,rejectionNotes:e.rejectionNotes})).data,onSuccess:(s,t)=>{e.invalidateQueries({queryKey:["escrow",t.escrowId]})}})}(),G=e=>{switch(e){case"pending":default:return"bg-gray-100 text-gray-800";case"in_progress":return"bg-blue-100 text-blue-800";case"submitted":return"bg-yellow-100 text-yellow-800";case"approved":case"released":return"bg-green-100 text-green-800";case"disputed":return"bg-red-100 text-red-800"}},L=async()=>{try{await U.mutateAsync({escrowId:o,milestoneId:s.id,approvalNotes:y}),N(!1),w("")}catch(e){console.error("Failed to approve milestone:",e)}},V=async()=>{try{await E.mutateAsync({escrowId:o,milestoneId:s.id,rejectionReason:Z,rejectionNotes:M}),f(!1),_(""),O("")}catch(e){console.error("Failed to reject milestone:",e)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i.Zb,{className:"relative",children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-100 text-blue-800 rounded-full font-semibold text-sm",children:t}),(0,a.jsxs)("div",{children:[(0,a.jsx)(i.ll,{className:"text-lg",children:s.title}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:s.description})]})]}),(0,a.jsxs)(c.C,{className:"".concat(G(s.status)," flex items-center gap-1"),children:[(e=>{switch(e){case"pending":case"in_progress":default:return(0,a.jsx)(x.Z,{className:"w-4 h-4"});case"submitted":return(0,a.jsx)(P.Z,{className:"w-4 h-4"});case"approved":case"released":return(0,a.jsx)(h.Z,{className:"w-4 h-4"});case"disputed":return(0,a.jsx)(u.Z,{className:"w-4 h-4"})}})(s.status),s.status.replace("_"," ").toUpperCase()]})]})}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(k.Z,{className:"w-4 h-4 text-gray-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Amount"}),(0,a.jsx)("p",{className:"font-semibold",children:(0,q.xG)(s.amount)})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-blue-500 rounded text-white flex items-center justify-center text-xs",children:"%"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Percentage"}),(0,a.jsxs)("p",{className:"font-semibold",children:[s.percentage,"%"]})]})]}),s.dueDate&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(z.Z,{className:"w-4 h-4 text-gray-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Due Date"}),(0,a.jsx)("p",{className:"font-semibold",children:(0,q.p6)(s.dueDate)})]})]})]}),s.approvalRequirements.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Approval Requirements"}),(0,a.jsx)("ul",{className:"list-disc list-inside space-y-1",children:s.approvalRequirements.map((e,s)=>(0,a.jsx)("li",{className:"text-sm text-gray-600",children:e},s))})]}),s.deliverables.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Deliverables"}),(0,a.jsx)("div",{className:"space-y-2",children:s.deliverables.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(P.Z,{className:"w-4 h-4 text-gray-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:e.title}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:e.description}),e.fileName&&(0,a.jsx)("p",{className:"text-xs text-blue-600",children:e.fileName})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(c.C,{className:G(e.status),children:e.status}),e.fileUrl&&(0,a.jsx)(r.z,{variant:"ghost",size:"sm",children:(0,a.jsx)(F.Z,{className:"w-4 h-4"})})]})]},e.id))})]}),s.notes&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Notes"}),(0,a.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-gray-700",children:s.notes})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-gray-600",children:[s.submittedAt&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:"Submitted"}),(0,a.jsx)("p",{children:(0,q.p6)(s.submittedAt)})]}),s.approvedAt&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:"Approved"}),(0,a.jsx)("p",{children:(0,q.p6)(s.approvedAt)})]}),s.releasedAt&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:"Released"}),(0,a.jsx)("p",{children:(0,q.p6)(s.releasedAt)})]}),s.disputedAt&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:"Disputed"}),(0,a.jsx)("p",{children:(0,q.p6)(s.disputedAt)})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 pt-4 border-t",children:["talent"===n&&Y.canSubmit&&(0,a.jsxs)(r.z,{onClick:()=>j(!0),children:[(0,a.jsx)(P.Z,{className:"w-4 h-4 mr-2"}),"Submit Milestone"]}),"talent"===n&&Y.needsResubmission&&(0,a.jsxs)(r.z,{variant:"outline",onClick:()=>j(!0),children:[(0,a.jsx)(P.Z,{className:"w-4 h-4 mr-2"}),"Resubmit"]}),"business"===n&&Y.canApprove&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(r.z,{onClick:()=>N(!0),children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),"Approve"]}),(0,a.jsxs)(r.z,{variant:"outline",onClick:()=>f(!0),children:[(0,a.jsx)(T.Z,{className:"w-4 h-4 mr-2"}),"Request Changes"]})]}),Y.canDispute&&(0,a.jsxs)(r.z,{variant:"outline",onClick:()=>m(s),children:[(0,a.jsx)(R.Z,{className:"w-4 h-4 mr-2"}),"Dispute"]})]}),g&&(0,a.jsxs)("div",{className:"space-y-4 p-4 bg-green-50 rounded-lg border border-green-200",children:[(0,a.jsx)("h4",{className:"font-medium text-green-900",children:"Approve Milestone"}),(0,a.jsx)(S.g,{placeholder:"Add approval notes (optional)...",value:y,onChange:e=>w(e.target.value),className:"bg-white"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(r.z,{onClick:L,disabled:U.isPending,children:U.isPending?"Approving...":"Confirm Approval"}),(0,a.jsx)(r.z,{variant:"ghost",onClick:()=>N(!1),children:"Cancel"})]})]}),b&&(0,a.jsxs)("div",{className:"space-y-4 p-4 bg-red-50 rounded-lg border border-red-200",children:[(0,a.jsx)("h4",{className:"font-medium text-red-900",children:"Request Changes"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-red-900 mb-1",children:"Reason for rejection *"}),(0,a.jsx)(S.g,{placeholder:"Explain what needs to be changed...",value:Z,onChange:e=>_(e.target.value),className:"bg-white",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-red-900 mb-1",children:"Additional notes (optional)"}),(0,a.jsx)(S.g,{placeholder:"Any additional feedback...",value:M,onChange:e=>O(e.target.value),className:"bg-white"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(r.z,{onClick:V,disabled:E.isPending||!Z.trim(),variant:"destructive",children:E.isPending?"Sending...":"Request Changes"}),(0,a.jsx)(r.z,{variant:"ghost",onClick:()=>f(!1),children:"Cancel"})]})]}),Y.needsResubmission&&(0,a.jsxs)(v.bZ,{className:"border-yellow-200 bg-yellow-50",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 text-yellow-600"}),(0,a.jsx)(v.X,{className:"text-yellow-800",children:"This milestone was rejected and needs to be resubmitted with the requested changes."})]}),Y.isDisputed&&(0,a.jsxs)(v.bZ,{className:"border-red-200 bg-red-50",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 text-red-600"}),(0,a.jsx)(v.X,{className:"text-red-800",children:"This milestone is currently under dispute. Please wait for admin resolution."})]})]})]}),p&&(0,a.jsx)(X,{escrowId:o,milestone:s,onClose:()=>j(!1)})]})}var K=t(68245);let W=Y.Ry({paymentMethodId:Y.Z_().min(1,"Payment method is required"),cardNumber:Y.Z_().regex(/^\d{4}\s\d{4}\s\d{4}\s\d{4}$/,"Invalid card number format"),expiryDate:Y.Z_().regex(/^\d{2}\/\d{2}$/,"Invalid expiry date format (MM/YY)"),cvv:Y.Z_().regex(/^\d{3,4}$/,"Invalid CVV"),cardholderName:Y.Z_().min(1,"Cardholder name is required"),billingAddress:Y.Ry({line1:Y.Z_().min(1,"Address is required"),city:Y.Z_().min(1,"City is required"),state:Y.Z_().min(1,"Province is required"),postalCode:Y.Z_().regex(/^[A-Za-z]\d[A-Za-z]\s?\d[A-Za-z]\d$/,"Invalid Canadian postal code"),country:Y.i0("CA")}),acceptTerms:Y.O7().refine(e=>!0===e,"You must accept the terms and conditions")});function Q(e){var s,t,c,d;let{escrowAccount:o,onClose:x}=e,[h,u]=(0,l.useState)(!1),[j,g]=(0,l.useState)(!1),N=function(){let e=(0,A.NL)();return(0,C.D)({mutationFn:async e=>(await D.x.post("/escrow/".concat(e.escrowId,"/fund"),{paymentMethodId:e.paymentMethodId})).data,onSuccess:s=>{e.setQueryData(["escrow",s.escrowAccount.id],s.escrowAccount),e.invalidateQueries({queryKey:["escrow"]})}})}(),{register:b,handleSubmit:y,watch:w,setValue:I,formState:{errors:S,isSubmitting:P}}=(0,M.cI)({resolver:(0,O.F)(W),defaultValues:{billingAddress:{country:"CA"},acceptTerms:!1}}),k=Z(o.totalAmount),z=_(o.totalAmount),F=k+z,T=o.totalAmount+F,R=o.totalAmount-F,Y=e=>{let s=e.replace(/\s+/g,"").replace(/[^0-9]/gi,""),t=s.match(/\d{4,16}/g),a=t&&t[0]||"",l=[];for(let e=0,s=a.length;e<s;e+=4)l.push(a.substring(e,e+4));return l.length?l.join(" "):s},G=e=>{let s=e.replace(/\D/g,"");return s.length>=2?s.substring(0,2)+"/"+s.substring(2,4):s},L=async e=>{u(!0);try{let e="pm_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));await N.mutateAsync({escrowId:o.id,paymentMethodId:e}),x()}catch(e){console.error("Failed to fund escrow:",e)}finally{u(!1)}};return(0,a.jsx)(U.Vq,{open:!0,onOpenChange:x,children:(0,a.jsxs)(U.cZ,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(U.fK,{children:[(0,a.jsxs)(U.$N,{className:"flex items-center gap-2",children:[(0,a.jsx)(f.Z,{className:"w-5 h-5"}),"Fund Escrow Account"]}),(0,a.jsx)(U.Be,{children:"Secure your project by funding the escrow account. Funds will be held safely and released to the talent upon milestone completion."})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{className:"text-lg",children:"Payment Summary"})}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{className:"text-sm font-medium text-gray-600",children:"Project Value"}),(0,a.jsx)("p",{className:"text-lg font-semibold",children:(0,q.xG)(o.totalAmount)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{className:"text-sm font-medium text-gray-600",children:"Milestones"}),(0,a.jsx)("p",{className:"text-lg font-semibold",children:o.milestones.length})]})]}),(0,a.jsxs)("div",{className:"space-y-2 pt-4 border-t",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Project Amount"}),(0,a.jsx)("span",{children:(0,q.xG)(o.totalAmount)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Platform Fee (5%)"}),(0,a.jsx)("span",{children:(0,q.xG)(k)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Payment Processing Fee"}),(0,a.jsx)("span",{children:(0,q.xG)(z)})]}),(0,a.jsxs)("div",{className:"flex justify-between font-semibold text-lg border-t pt-2",children:[(0,a.jsx)("span",{children:"Total Charge"}),(0,a.jsx)("span",{children:(0,q.xG)(T)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm text-green-600",children:[(0,a.jsx)("span",{children:"Net to Talent"}),(0,a.jsx)("span",{children:(0,q.xG)(R)})]})]})]})]}),(0,a.jsxs)(v.bZ,{className:"border-blue-200 bg-blue-50",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 text-blue-600"}),(0,a.jsx)(v.X,{className:"text-blue-800",children:"Your payment is secured by Stripe and protected by our escrow system. Funds are only released when you approve completed milestones."})]}),j?(0,a.jsxs)("form",{onSubmit:y(L),className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(E._,{className:"text-base font-semibold",children:"Card Information"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{htmlFor:"cardNumber",children:"Card Number *"}),(0,a.jsx)(n.I,{...b("cardNumber"),placeholder:"1234 5678 9012 3456",maxLength:19,onChange:e=>{I("cardNumber",Y(e.target.value))}}),S.cardNumber&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:S.cardNumber.message})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{htmlFor:"expiryDate",children:"Expiry Date *"}),(0,a.jsx)(n.I,{...b("expiryDate"),placeholder:"MM/YY",maxLength:5,onChange:e=>{I("expiryDate",G(e.target.value))}}),S.expiryDate&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:S.expiryDate.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{htmlFor:"cvv",children:"CVV *"}),(0,a.jsx)(n.I,{...b("cvv"),placeholder:"123",maxLength:4,type:"password"}),S.cvv&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:S.cvv.message})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{htmlFor:"cardholderName",children:"Cardholder Name *"}),(0,a.jsx)(n.I,{...b("cardholderName"),placeholder:"John Doe"}),S.cardholderName&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:S.cardholderName.message})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(E._,{className:"text-base font-semibold",children:"Billing Address"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{htmlFor:"billingAddress.line1",children:"Address *"}),(0,a.jsx)(n.I,{...b("billingAddress.line1"),placeholder:"123 Main Street"}),(null===(s=S.billingAddress)||void 0===s?void 0:s.line1)&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:S.billingAddress.line1.message})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{htmlFor:"billingAddress.city",children:"City *"}),(0,a.jsx)(n.I,{...b("billingAddress.city"),placeholder:"Toronto"}),(null===(t=S.billingAddress)||void 0===t?void 0:t.city)&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:S.billingAddress.city.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{htmlFor:"billingAddress.state",children:"Province *"}),(0,a.jsx)(n.I,{...b("billingAddress.state"),placeholder:"ON"}),(null===(c=S.billingAddress)||void 0===c?void 0:c.state)&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:S.billingAddress.state.message})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{htmlFor:"billingAddress.postalCode",children:"Postal Code *"}),(0,a.jsx)(n.I,{...b("billingAddress.postalCode"),placeholder:"K1A 0A6"}),(null===(d=S.billingAddress)||void 0===d?void 0:d.postalCode)&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:S.billingAddress.postalCode.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{htmlFor:"billingAddress.country",children:"Country"}),(0,a.jsx)(n.I,{value:"Canada",disabled:!0,className:"bg-gray-50"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(K.X,{id:"acceptTerms",checked:w("acceptTerms"),onCheckedChange:e=>I("acceptTerms",e)}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)(E._,{htmlFor:"acceptTerms",className:"cursor-pointer",children:["I accept the"," ",(0,a.jsx)("a",{href:"/terms",className:"text-blue-600 hover:underline",children:"Terms and Conditions"})," ","and"," ",(0,a.jsx)("a",{href:"/privacy",className:"text-blue-600 hover:underline",children:"Privacy Policy"})]}),S.acceptTerms&&(0,a.jsx)("p",{className:"text-red-600 mt-1",children:S.acceptTerms.message})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-6 border-t",children:[(0,a.jsx)(r.z,{type:"button",variant:"outline",onClick:()=>g(!1),children:"Back"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Total Charge"}),(0,a.jsx)("p",{className:"text-lg font-semibold",children:(0,q.xG)(T)})]}),(0,a.jsx)(r.z,{type:"submit",disabled:P||h||N.isPending,className:"min-w-[120px]",children:h||N.isPending?"Processing...":(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),"Fund Escrow"]})})]})]})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(E._,{className:"text-base font-semibold",children:"Payment Method"}),(0,a.jsx)(i.Zb,{className:"cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>g(!0),children:(0,a.jsxs)(i.aY,{className:"flex items-center justify-between p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(f.Z,{className:"w-6 h-6 text-gray-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:"Credit or Debit Card"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Visa, Mastercard, American Express"})]})]}),(0,a.jsx)(r.z,{variant:"outline",size:"sm",children:"Select"})]})}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(r.z,{variant:"ghost",onClick:x,children:"Cancel"})})]})]})]})})}var $=t(42325),J=t(40519);let H=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)($.fC,{className:(0,q.cn)("grid gap-2",t),...l,ref:s})});H.displayName=$.fC.displayName;let ee=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)($.ck,{ref:s,className:(0,q.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...l,children:(0,a.jsx)($.z$,{className:"flex items-center justify-center",children:(0,a.jsx)(J.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});ee.displayName=$.ck.displayName;var es=t(57011),et=t(59055);let ea=Y.Ry({reason:Y.Km(["work_not_completed","work_quality_issues","missed_deadline","scope_disagreement","communication_issues","payment_delay","contract_violation","other"],{required_error:"Please select a dispute reason"}),description:Y.Z_().min(50,"Please provide at least 50 characters describing the issue"),evidence:Y.Z_().optional()}),el={work_not_completed:{label:"Work Not Completed",description:"The deliverables were not completed as agreed"},work_quality_issues:{label:"Quality Issues",description:"The work quality does not meet the agreed standards"},missed_deadline:{label:"Missed Deadline",description:"The milestone was not delivered on time"},scope_disagreement:{label:"Scope Disagreement",description:"There is disagreement about what work should be included"},communication_issues:{label:"Communication Issues",description:"Poor communication or unresponsiveness"},payment_delay:{label:"Payment Delay",description:"Payment approval is being unreasonably delayed"},contract_violation:{label:"Contract Violation",description:"Terms of the contract have been violated"},other:{label:"Other",description:"Other issues not covered above"}};function ei(e){let{escrowId:s,milestone:t,userRole:n,onClose:c}=e,[d,o]=(0,l.useState)(!1),m=function(){let e=(0,A.NL)();return(0,C.D)({mutationFn:async e=>(await D.x.post("/escrow/".concat(e.escrowId,"/disputes/create"),e)).data,onSuccess:(s,t)=>{e.invalidateQueries({queryKey:["escrow",t.escrowId]}),e.invalidateQueries({queryKey:["disputes"]})}})}(),{register:x,handleSubmit:h,watch:p,setValue:j,formState:{errors:g}}=(0,M.cI)({resolver:(0,O.F)(ea)}),N=p("reason"),b=async e=>{o(!0);try{await m.mutateAsync({escrowId:s,milestoneId:t.id,initiatedBy:n,reason:e.reason,description:e.description+(e.evidence?"\n\nEvidence:\n".concat(e.evidence):"")}),c()}catch(e){console.error("Failed to initiate dispute:",e)}finally{o(!1)}};return(0,a.jsx)(U.Vq,{open:!0,onOpenChange:c,children:(0,a.jsxs)(U.cZ,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(U.fK,{children:[(0,a.jsxs)(U.$N,{className:"flex items-center gap-2",children:[(0,a.jsx)(u.Z,{className:"w-5 h-5 text-red-600"}),"Initiate Dispute"]}),(0,a.jsx)(U.Be,{children:"If you have concerns about this milestone, you can initiate a dispute. Our team will review the situation and help resolve the issue."})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{className:"text-lg",children:"Milestone Details"})}),(0,a.jsxs)(i.aY,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{className:"text-sm font-medium text-gray-600",children:"Title"}),(0,a.jsx)("p",{className:"font-medium",children:t.title})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{className:"text-sm font-medium text-gray-600",children:"Amount"}),(0,a.jsx)("p",{className:"font-medium",children:(0,q.xG)(t.amount)})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{className:"text-sm font-medium text-gray-600",children:"Description"}),(0,a.jsx)("p",{className:"text-gray-700",children:t.description})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E._,{className:"text-sm font-medium text-gray-600",children:"Current Status"}),(0,a.jsx)("p",{className:"font-medium capitalize",children:t.status.replace("_"," ")})]})]})]}),(0,a.jsxs)(v.bZ,{className:"border-yellow-200 bg-yellow-50",children:[(0,a.jsx)(es.Z,{className:"w-4 h-4 text-yellow-600"}),(0,a.jsxs)(v.X,{className:"text-yellow-800",children:[(0,a.jsx)("strong",{children:"Important:"})," Initiating a dispute will pause all milestone activities until the issue is resolved. Please try to resolve the issue directly with the other party first through our messaging system."]})]}),(0,a.jsxs)("form",{onSubmit:h(b),className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(E._,{className:"text-base font-semibold",children:"Reason for Dispute *"}),(0,a.jsx)(H,{value:N,onValueChange:e=>j("reason",e),children:Object.entries(el).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(ee,{value:s,id:s,className:"mt-1"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(E._,{htmlFor:s,className:"cursor-pointer font-medium",children:t.label}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:t.description})]})]},s)})}),g.reason&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:g.reason.message})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(E._,{htmlFor:"description",className:"text-base font-semibold",children:"Detailed Description *"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Please provide a clear and detailed explanation of the issue. Include specific examples and any relevant context."}),(0,a.jsx)(S.g,{...x("description"),placeholder:"Describe the issue in detail. What happened? What was expected? What evidence do you have?",rows:6,className:"resize-none"}),g.description&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:g.description.message})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(E._,{htmlFor:"evidence",className:"text-base font-semibold",children:"Supporting Evidence (Optional)"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Include any additional evidence such as screenshots, file references, or communication logs that support your dispute."}),(0,a.jsx)(S.g,{...x("evidence"),placeholder:"List any files, screenshots, messages, or other evidence that supports your case...",rows:4,className:"resize-none"})]}),(0,a.jsxs)(i.Zb,{className:"bg-blue-50 border-blue-200",children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"text-lg flex items-center gap-2",children:[(0,a.jsx)(et.Z,{className:"w-5 h-5 text-blue-600"}),"Dispute Resolution Process"]})}),(0,a.jsx)(i.aY,{className:"space-y-2",children:(0,a.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,a.jsx)("p",{className:"font-medium mb-2",children:"What happens next:"}),(0,a.jsxs)("ol",{className:"list-decimal list-inside space-y-1",children:[(0,a.jsx)("li",{children:"Your dispute will be submitted to our resolution team"}),(0,a.jsx)("li",{children:"Both parties will be notified and can provide additional information"}),(0,a.jsx)("li",{children:"Our team will review all evidence and communications"}),(0,a.jsx)("li",{children:"A resolution will be determined within 5-7 business days"}),(0,a.jsx)("li",{children:"Funds will be released or refunded based on the decision"})]})]})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3 pt-6 border-t",children:[(0,a.jsx)(r.z,{type:"button",variant:"outline",onClick:c,children:"Cancel"}),(0,a.jsx)(r.z,{type:"submit",variant:"destructive",disabled:d||m.isPending,children:d||m.isPending?"Submitting Dispute...":(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.Z,{className:"w-4 h-4 mr-2"}),"Initiate Dispute"]})})]})]})]})]})})}function er(e){let{escrowId:s,userRole:t,userId:n}=e,[o,p]=(0,l.useState)(!1),[j,g]=(0,l.useState)(!1),[A,C]=(0,l.useState)(null),{data:I,isLoading:S,error:P}=(0,w.a)({queryKey:["escrow",s],queryFn:async()=>(await D.x.get("/escrow/".concat(s))).data,enabled:!!s}),k=function(e){let[s,t]=(0,l.useState)({total:0,completed:0,inProgress:0,pending:0,disputed:0,completionPercentage:0,amountReleased:0,totalAmount:0});return(0,l.useEffect)(()=>{let s=e.length,a=e.filter(e=>"released"===e.status).length,l=e.filter(e=>"in_progress"===e.status||"submitted"===e.status).length,i=e.filter(e=>"pending"===e.status).length;t({total:s,completed:a,inProgress:l,pending:i,disputed:e.filter(e=>"disputed"===e.status).length,completionPercentage:s>0?Math.round(a/s*100):0,amountReleased:e.filter(e=>"released"===e.status).reduce((e,s)=>e+s.amount,0),totalAmount:e.reduce((e,s)=>e+s.amount,0)})},[e]),s}((null==I?void 0:I.milestones)||[]),z=function(e){if(!e)return null;let s="created"===e.status,t="funded"===e.status||"partially_released"===e.status,a="completed"!==e.status&&"cancelled"!==e.status;return{canFund:s,canSubmitMilestones:t,canCancel:a,hasDisputes:e.milestones.some(e=>"disputed"===e.status),isCompleted:"completed"===e.status,isCancelled:"cancelled"===e.status,status:e.status}}(I),F=(0,l.useState)(()=>I?function(e){let s=e.milestones.filter(e=>"released"===e.status),t=s.reduce((e,s)=>e+s.amount,0),a=e.totalAmount-t,l=Z(e.totalAmount),i=_(e.totalAmount),r=e.totalAmount-l-i,n=e.milestones.length>0?s.length/e.milestones.length*100:0;return{totalAmount:e.totalAmount,releasedAmount:t,pendingAmount:a,platformFees:l,stripeFees:i,netToTalent:r,completionPercentage:Math.round(n)}}(I):null)[0];return S?(0,a.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,a.jsx)(b.Z,{className:"w-6 h-6 animate-spin text-blue-600"}),(0,a.jsx)("span",{className:"ml-2",children:"Loading escrow details..."})]}):P||!I?(0,a.jsxs)(v.bZ,{className:"border-red-200 bg-red-50",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 text-red-600"}),(0,a.jsx)(v.X,{className:"text-red-800",children:"Failed to load escrow account. Please try again."})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Escrow Account"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Contract ID: ",I.contractId]})]}),(0,a.jsxs)(c.C,{className:"".concat((e=>{switch(e){case"created":case"cancelled":default:return"bg-gray-100 text-gray-800";case"funded":return"bg-blue-100 text-blue-800";case"partially_released":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"disputed":return"bg-red-100 text-red-800"}})(I.status)," flex items-center gap-1"),children:[(e=>{switch(e){case"created":default:return(0,a.jsx)(x.Z,{className:"w-4 h-4"});case"funded":return(0,a.jsx)(f.Z,{className:"w-4 h-4"});case"partially_released":return(0,a.jsx)(m.Z,{className:"w-4 h-4"});case"completed":return(0,a.jsx)(h.Z,{className:"w-4 h-4"});case"disputed":case"cancelled":return(0,a.jsx)(u.Z,{className:"w-4 h-4"})}})(I.status),I.status.replace("_"," ").toUpperCase()]})]}),(null==z?void 0:z.hasDisputes)&&(0,a.jsxs)(v.bZ,{className:"border-red-200 bg-red-50",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 text-red-600"}),(0,a.jsx)(v.X,{className:"text-red-800",children:"This escrow account has active disputes that require attention."})]}),"created"===I.status&&"business"===t&&(0,a.jsxs)(v.bZ,{className:"border-blue-200 bg-blue-50",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4 text-blue-600"}),(0,a.jsxs)(v.X,{className:"text-blue-800",children:["Please fund this escrow account to activate milestone payments.",(0,a.jsx)(r.z,{variant:"link",className:"p-0 h-auto ml-2 text-blue-600",onClick:()=>p(!0),children:"Fund Now"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{className:"pb-2",children:(0,a.jsx)(i.ll,{className:"text-sm font-medium text-gray-600",children:"Total Amount"})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:(0,q.xG)(I.totalAmount)}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:I.currency.toUpperCase()})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{className:"pb-2",children:(0,a.jsx)(i.ll,{className:"text-sm font-medium text-gray-600",children:"Released"})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(0,q.xG)(k.amountReleased)}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[k.completed," of ",k.total," milestones"]})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{className:"pb-2",children:(0,a.jsx)(i.ll,{className:"text-sm font-medium text-gray-600",children:"Progress"})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[k.completionPercentage,"%"]}),(0,a.jsx)(N.E,{value:k.completionPercentage,className:"mt-2"})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{className:"pb-2",children:(0,a.jsx)(i.ll,{className:"text-sm font-medium text-gray-600",children:"Net to Talent"})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:F?(0,q.xG)(F.netToTalent):"--"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"After fees"})]})]})]}),(0,a.jsxs)(d.mQ,{defaultValue:"milestones",className:"space-y-6",children:[(0,a.jsxs)(d.dr,{children:[(0,a.jsx)(d.SP,{value:"milestones",children:"Milestones"}),(0,a.jsx)(d.SP,{value:"transactions",children:"Transactions"}),(0,a.jsx)(d.SP,{value:"details",children:"Details"}),(null==z?void 0:z.hasDisputes)&&(0,a.jsx)(d.SP,{value:"disputes",children:"Disputes"})]}),(0,a.jsxs)(d.nU,{value:"milestones",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Project Milestones"}),"business"===t&&(null==z?void 0:z.canFund)&&(0,a.jsxs)(r.z,{onClick:()=>p(!0),children:[(0,a.jsx)(f.Z,{className:"w-4 h-4 mr-2"}),"Fund Escrow"]})]}),(0,a.jsx)("div",{className:"space-y-4",children:I.milestones.map((e,l)=>(0,a.jsx)(B,{milestone:e,milestoneNumber:l+1,userRole:t,userId:n,escrowId:s,onDispute:e=>{C(e),g(!0)}},e.id))})]}),(0,a.jsx)(d.nU,{value:"transactions",children:(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(y.Z,{className:"w-5 h-5"}),"Transaction History"]})}),(0,a.jsx)(i.aY,{children:(0,a.jsx)("p",{className:"text-gray-600",children:"Transaction history will be displayed here."})})]})}),(0,a.jsx)(d.nU,{value:"details",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{children:"Escrow Details"})}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Escrow ID"}),(0,a.jsx)("p",{className:"text-gray-900",children:I.id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Contract ID"}),(0,a.jsx)("p",{className:"text-gray-900",children:I.contractId})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Created"}),(0,a.jsx)("p",{className:"text-gray-900",children:(0,q.p6)(I.createdAt)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Last Updated"}),(0,a.jsx)("p",{className:"text-gray-900",children:(0,q.p6)(I.updatedAt)})]})]})]}),F&&(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{children:"Fee Breakdown"})}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Gross Amount"}),(0,a.jsx)("span",{className:"font-medium",children:(0,q.xG)(F.totalAmount)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Platform Fee"}),(0,a.jsxs)("span",{className:"font-medium",children:["-",(0,q.xG)(F.platformFees)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Stripe Fee"}),(0,a.jsxs)("span",{className:"font-medium",children:["-",(0,q.xG)(F.stripeFees)]})]}),(0,a.jsx)("div",{className:"border-t pt-2",children:(0,a.jsxs)("div",{className:"flex justify-between font-semibold",children:[(0,a.jsx)("span",{children:"Net to Talent"}),(0,a.jsx)("span",{children:(0,q.xG)(F.netToTalent)})]})})]})]})]})}),(null==z?void 0:z.hasDisputes)&&(0,a.jsx)(d.nU,{value:"disputes",children:(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(u.Z,{className:"w-5 h-5 text-red-600"}),"Active Disputes"]})}),(0,a.jsx)(i.aY,{children:(0,a.jsx)("p",{className:"text-gray-600",children:"Dispute management interface will be displayed here."})})]})})]}),o&&(0,a.jsx)(Q,{escrowAccount:I,onClose:()=>p(!1)}),j&&A&&(0,a.jsx)(ei,{escrowId:s,milestone:A,userRole:t,onClose:()=>{g(!1),C(null)}})]})}let en="force-dynamic",ec=[{id:"escrow1",contractId:"contract1",businessName:"Tech Corp Inc.",talentName:"John Doe",projectTitle:"E-commerce Website Development",totalAmount:5e3,releasedAmount:2e3,pendingAmount:3e3,status:"partially_released",createdAt:new Date("2024-01-15"),lastActivity:new Date("2024-01-28"),milestones:5,completedMilestones:2,hasDisputes:!1},{id:"escrow2",contractId:"contract2",businessName:"Startup LLC",talentName:"Jane Smith",projectTitle:"Mobile App UI/UX Design",totalAmount:3500,releasedAmount:0,pendingAmount:3500,status:"funded",createdAt:new Date("2024-01-20"),lastActivity:new Date("2024-01-29"),milestones:3,completedMilestones:0,hasDisputes:!1},{id:"escrow3",contractId:"contract3",businessName:"Digital Agency",talentName:"Mike Johnson",projectTitle:"Brand Identity Design",totalAmount:2500,releasedAmount:1e3,pendingAmount:1500,status:"disputed",createdAt:new Date("2024-01-12"),lastActivity:new Date("2024-01-27"),milestones:4,completedMilestones:2,hasDisputes:!0}];function ed(){let[e,s]=(0,l.useState)(""),[t,N]=(0,l.useState)("all"),[v,b]=(0,l.useState)(null),f=ec.filter(s=>{let a=s.projectTitle.toLowerCase().includes(e.toLowerCase())||s.businessName.toLowerCase().includes(e.toLowerCase())||s.talentName.toLowerCase().includes(e.toLowerCase()),l="all"===t||s.status===t;return a&&l}),y=e=>{switch(e){case"funded":return"bg-blue-100 text-blue-800";case"partially_released":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"disputed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},w=e=>{switch(e){case"funded":return(0,a.jsx)(m.Z,{className:"w-4 h-4"});case"partially_released":return(0,a.jsx)(x.Z,{className:"w-4 h-4"});case"completed":return(0,a.jsx)(h.Z,{className:"w-4 h-4"});case"disputed":return(0,a.jsx)(u.Z,{className:"w-4 h-4"});default:return(0,a.jsx)(p.Z,{className:"w-4 h-4"})}},A=ec.reduce((e,s)=>e+s.totalAmount,0),C=ec.reduce((e,s)=>e+s.releasedAmount,0),Z=ec.reduce((e,s)=>e+s.pendingAmount,0),_=ec.filter(e=>e.hasDisputes).length;return v?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(r.z,{variant:"outline",onClick:()=>b(null),children:"â† Back to Escrow List"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Escrow Account Details"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["ID: ",v]})]})]}),(0,a.jsx)(er,{escrowId:v,userRole:"admin",userId:"admin"})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Escrow Management"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Monitor and manage all escrow accounts across the platform"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{className:"pb-2",children:(0,a.jsx)(i.ll,{className:"text-sm font-medium text-gray-600",children:"Total Escrow Value"})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:(0,q.xG)(A)}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Across ",ec.length," accounts"]})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{className:"pb-2",children:(0,a.jsx)(i.ll,{className:"text-sm font-medium text-gray-600",children:"Released Funds"})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(0,q.xG)(C)}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[Math.round(C/A*100),"% of total"]})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{className:"pb-2",children:(0,a.jsx)(i.ll,{className:"text-sm font-medium text-gray-600",children:"Pending Funds"})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:(0,q.xG)(Z)}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Awaiting milestone completion"})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{className:"pb-2",children:(0,a.jsx)(i.ll,{className:"text-sm font-medium text-gray-600",children:"Disputed Accounts"})}),(0,a.jsxs)(i.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:_}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Require admin attention"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,a.jsx)(j.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,a.jsx)(n.I,{placeholder:"Search escrow accounts...",value:e,onChange:e=>s(e.target.value),className:"pl-10"})]}),(0,a.jsx)(d.mQ,{value:t,onValueChange:e=>N(e),children:(0,a.jsxs)(d.dr,{children:[(0,a.jsx)(d.SP,{value:"all",children:"All"}),(0,a.jsx)(d.SP,{value:"funded",children:"Funded"}),(0,a.jsx)(d.SP,{value:"partially_released",children:"In Progress"}),(0,a.jsx)(d.SP,{value:"disputed",children:"Disputed"}),(0,a.jsx)(d.SP,{value:"completed",children:"Completed"})]})})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{children:["Escrow Accounts (",f.length,")"]})}),(0,a.jsx)(i.aY,{children:(0,a.jsx)("div",{className:"space-y-4",children:f.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-full",children:w(e.status)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium",children:e.projectTitle}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[e.businessName," â†’ ",e.talentName]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-1",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["Created ",(0,q.p6)(e.createdAt)]}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["Last activity ",(0,q.p6)(e.lastActivity)]}),e.hasDisputes&&(0,a.jsxs)(c.C,{variant:"destructive",className:"text-xs",children:[(0,a.jsx)(u.Z,{className:"w-3 h-3 mr-1"}),"Disputed"]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Progress"}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:[e.completedMilestones,"/",e.milestones," milestones"]}),(0,a.jsx)("div",{className:"w-16 bg-gray-200 rounded-full h-2 mt-1",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(e.completedMilestones/e.milestones*100,"%")}})})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"font-medium",children:(0,q.xG)(e.totalAmount)}),(0,a.jsxs)("p",{className:"text-sm text-green-600",children:[(0,q.xG)(e.releasedAmount)," released"]}),(0,a.jsxs)("p",{className:"text-sm text-yellow-600",children:[(0,q.xG)(e.pendingAmount)," pending"]})]}),(0,a.jsxs)(c.C,{className:"".concat(y(e.status)," flex items-center gap-1"),children:[w(e.status),e.status.replace("_"," ").toUpperCase()]}),(0,a.jsxs)(o.h_,{children:[(0,a.jsx)(o.$F,{asChild:!0,children:(0,a.jsx)(r.z,{variant:"ghost",size:"sm",children:(0,a.jsx)(g.Z,{className:"w-4 h-4"})})}),(0,a.jsxs)(o.AW,{align:"end",children:[(0,a.jsx)(o.Xi,{onClick:()=>b(e.id),children:"View Details"}),(0,a.jsx)(o.Xi,{children:"View Contract"}),(0,a.jsx)(o.Xi,{children:"Transaction History"}),e.hasDisputes&&(0,a.jsx)(o.Xi,{className:"text-red-600",children:"Resolve Dispute"})]})]})]})]},e.id))})})]})]})}},7204:function(e,s,t){"use strict";t.d(s,{E:function(){return n}});var a=t(57437),l=t(2265),i=t(60610),r=t(93448);let n=l.forwardRef((e,s)=>{let{className:t,value:l,...n}=e;return(0,a.jsx)(i.fC,{ref:s,className:(0,r.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...n,children:(0,a.jsx)(i.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(l||0),"%)")}})})});n.displayName=i.fC.displayName},3227:function(e,s,t){"use strict";t.d(s,{x:function(){return a.apiClient}});var a=t(26305)},26305:function(e,s,t){"use strict";t.d(s,{apiClient:function(){return i}});var a=t(83464);class l{async get(e,s){return(await this.client.get(e,s)).data}async post(e,s,t){return(await this.client.post(e,s,t)).data}async put(e,s,t){return(await this.client.put(e,s,t)).data}async patch(e,s,t){return(await this.client.patch(e,s,t)).data}async delete(e,s){return(await this.client.delete(e,s)).data}async getBlob(e,s){return(await this.client.get(e,{...s,responseType:"blob"})).data}constructor(){this.client=a.Z.create({baseURL:"http://localhost:5000/api",timeout:1e4,withCredentials:!0}),this.client.interceptors.request.use(e=>{let s=localStorage.getItem("token")||sessionStorage.getItem("token")||localStorage.getItem("localtalents_token")||localStorage.getItem("accessToken")||localStorage.getItem("localtalents_accessToken");return console.log("\uD83D\uDD0D API Client: Request interceptor",{url:e.url,hasToken:!!s}),s?(e.headers.Authorization="Bearer ".concat(s),console.log("âœ… API Client: Added Authorization header")):console.log("âŒ API Client: No token found in any storage location"),e},e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,async e=>{var s,t;let l=e.config;if((null===(s=e.response)||void 0===s?void 0:s.status)===401&&!l._retry){l._retry=!0;try{let e=localStorage.getItem("refreshToken");if(e){let{accessToken:s}=(await a.Z.post("".concat(this.client.defaults.baseURL,"/auth/refresh"),{refreshToken:e})).data.tokens;return localStorage.setItem("token",s),l.headers.Authorization="Bearer ".concat(s),this.client(l)}}catch(s){localStorage.removeItem("token"),localStorage.removeItem("refreshToken");let e=window.location.pathname;return(e.startsWith("/business")||e.startsWith("/talent")||e.startsWith("/admin"))&&(window.location.href="/login"),Promise.reject(s)}}if((null===(t=e.response)||void 0===t?void 0:t.status)===401){let e=window.location.pathname,s=e.startsWith("/business")||e.startsWith("/talent")||e.startsWith("/admin");localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),s&&(window.location.href="/login")}return Promise.reject(e)})}}let i=new l}},function(e){e.O(0,[6137,3464,4690,271,7983,7626,7954,4561,6075,4026,2123,2971,2117,1744],function(){return e(e.s=72938)}),_N_E=e.O()}]);