(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[179],{27139:function(e,s,a){Promise.resolve().then(a.bind(a,86639))},86639:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return d}});var n=a(57437),o=a(2265),t=a(99376),r=a(53689),l=a(269),i=a(45710),c=a(34980);function d(){let{user:e}=(0,i.a)(),s=(0,t.useSearchParams)(),[a,d]=(0,o.useState)(null),[u,g]=(0,o.useState)([]),[v,D]=(0,o.useState)([]),[f,h]=(0,o.useState)(!0),[m,x]=(0,o.useState)(null),y=s.get("talentId"),b=s.get("applicationId");(0,o.useEffect)(()=>{p()},[]),(0,o.useEffect)(()=>{a&&w(a)},[a]),(0,o.useEffect)(()=>{if(y&&b&&u.length>0){let e=u.find(e=>{var s;return null===(s=e.participantUsers)||void 0===s?void 0:s.some(e=>e.id===y)});e?d(e.id):C(y,b)}},[y,b,u]);let p=async()=>{try{h(!0);let e=await c.Y.getConversations();console.log("\uD83D\uDCE8 Talent conversations response:",e),g(e.conversations)}catch(e){console.error("Failed to load conversations:",e),x("Failed to load conversations"),g([])}finally{h(!1)}},w=async e=>{try{console.log("\uD83D\uDD0D Loading messages for conversation:",e);let s=await c.Y.getMessages({conversationId:e});console.log("\uD83D\uDCE8 Messages response:",s),console.log("\uD83D\uDCE8 Messages array:",s.messages),D(s.messages)}catch(e){console.error("Failed to load messages:",e),D([])}},C=async(s,a)=>{try{let n=await c.Y.findOrCreateConversation([e.id,s],a);d(n.id),p()}catch(e){console.error("Failed to create conversation:",e),x("Failed to start conversation")}},j=u.find(e=>e.id===a)||null,N=v.filter(e=>e.conversationId===a);console.log("\uD83D\uDD0D Debug - selectedConversationId:",a),console.log("\uD83D\uDD0D Debug - all messages:",v),console.log("\uD83D\uDD0D Debug - filtered conversationMessages:",N);let E=async(e,s)=>{if(a)try{await c.Y.sendMessage(a,{content:e,attachments:s}),w(a)}catch(e){console.error("Failed to send message:",e)}},k=async e=>{if(a)try{await c.Y.markAsRead(a,e)}catch(e){console.error("Failed to mark as read:",e)}};return e?m?(0,n.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-red-600 mb-4",children:m}),(0,n.jsx)("button",{onClick:p,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Try Again"})]})}):(0,n.jsxs)("div",{className:"h-[calc(100vh-200px)] flex bg-white rounded-lg shadow",children:[(0,n.jsx)("div",{className:"w-1/3 border-r border-gray-200",children:(0,n.jsx)(r.p,{conversations:u,selectedConversationId:a||void 0,onConversationSelect:d,currentUserId:(null==e?void 0:e.id)||""})}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(l.z,{conversation:j,messages:N,currentUserId:(null==e?void 0:e.id)||"",onSendMessage:E,onMarkAsRead:k,isLoading:f})})]}):(0,n.jsx)("div",{children:"Please log in to view messages."})}}},function(e){e.O(0,[6137,3464,5710,7922,2971,2117,1744],function(){return e(e.s=27139)}),_N_E=e.O()}]);