"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5710,6305],{26305:function(e,t,o){o.d(t,{apiClient:function(){return a}});var s=o(83464);class r{async get(e,t){return(await this.client.get(e,t)).data}async post(e,t,o){return(await this.client.post(e,t,o)).data}async put(e,t,o){return(await this.client.put(e,t,o)).data}async patch(e,t,o){return(await this.client.patch(e,t,o)).data}async delete(e,t){return(await this.client.delete(e,t)).data}async getBlob(e,t){return(await this.client.get(e,{...t,responseType:"blob"})).data}constructor(){this.client=s.Z.create({baseURL:"http://localhost:5000/api",timeout:1e4,withCredentials:!0}),this.client.interceptors.request.use(e=>{let t=localStorage.getItem("token")||sessionStorage.getItem("token")||localStorage.getItem("localtalents_token")||localStorage.getItem("accessToken")||localStorage.getItem("localtalents_accessToken");return console.log("\uD83D\uDD0D API Client: Request interceptor",{url:e.url,hasToken:!!t}),t?(e.headers.Authorization="Bearer ".concat(t),console.log("✅ API Client: Added Authorization header")):console.log("❌ API Client: No token found in any storage location"),e},e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,async e=>{var t,o;let r=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!r._retry){r._retry=!0;try{let e=localStorage.getItem("refreshToken");if(e){let{accessToken:t}=(await s.Z.post("".concat(this.client.defaults.baseURL,"/auth/refresh"),{refreshToken:e})).data.tokens;return localStorage.setItem("token",t),r.headers.Authorization="Bearer ".concat(t),this.client(r)}}catch(t){localStorage.removeItem("token"),localStorage.removeItem("refreshToken");let e=window.location.pathname;return(e.startsWith("/business")||e.startsWith("/talent")||e.startsWith("/admin"))&&(window.location.href="/login"),Promise.reject(t)}}if((null===(o=e.response)||void 0===o?void 0:o.status)===401){let e=window.location.pathname,t=e.startsWith("/business")||e.startsWith("/talent")||e.startsWith("/admin");localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),t&&(window.location.href="/login")}return Promise.reject(e)})}}let a=new r},45710:function(e,t,o){o.d(t,{H:function(){return u},a:function(){return g}});var s=o(57437),r=o(2265),a=o(99376),n=o(26305);class l{async register(e){return n.apiClient.post("/auth/register",e)}async login(e){return n.apiClient.post("/auth/login",e)}async logout(){return n.apiClient.post("/auth/logout")}async refreshTokens(){return n.apiClient.post("/auth/refresh")}async getProfile(){return n.apiClient.get("/auth/profile")}async checkAuth(){return n.apiClient.get("/auth/check")}async changePassword(e){return n.apiClient.post("/auth/change-password",e)}async forgotPassword(e){return n.apiClient.post("/auth/forgot-password",e)}async resetPassword(e){return n.apiClient.post("/auth/reset-password",e)}async verifyEmail(e){return n.apiClient.post("/auth/verify-email",{token:e})}async resendVerification(e){return n.apiClient.post("/auth/resend-verification",{email:e})}async deleteAccount(){return n.apiClient.delete("/auth/account")}}let i=new l,c=(0,r.createContext)(void 0);function u(e){let{children:t}=e,[o,n]=(0,r.useState)(null),[l,u]=(0,r.useState)(!0),g=(0,a.useRouter)();(0,r.useEffect)(()=>{h()},[]);let h=async()=>{try{console.log("\uD83D\uDD0D Auth check: Starting auth status check"),console.log("\uD83D\uDD0D Auth check: Checking stored tokens..."),localStorage.getItem("token"),localStorage.getItem("refreshToken");let e=await i.checkAuth();console.log("✅ Auth check: Success",e.user),n(e.user||null),u(!1)}catch(e){console.error("❌ Auth check failed:",e),console.log("\uD83D\uDD0D Auth check: Clearing user state and invalid tokens"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("token"),localStorage.removeItem("localtalents_accessToken"),localStorage.removeItem("localtalents_refreshToken"),sessionStorage.removeItem("token"),n(null),u(!1)}},k=async(e,t,o)=>{try{let s={email:e,password:t,...(null==o?void 0:o.userType)==="admin"&&{userType:"admin",adminCode:o.adminCode}},r=await i.login(s);if((null==o?void 0:o.userType)==="admin"&&"admin"!==r.user.userType)throw Error("Invalid admin credentials");if(r.tokens)try{console.log("\uD83D\uDCBE Login: Storing tokens in multiple storage locations..."),localStorage.setItem("token",r.tokens.accessToken),localStorage.setItem("refreshToken",r.tokens.refreshToken),sessionStorage.setItem("token",r.tokens.accessToken),sessionStorage.setItem("refreshToken",r.tokens.refreshToken),localStorage.setItem("localtalents_token",r.tokens.accessToken),localStorage.setItem("localtalents_refresh",r.tokens.refreshToken),console.log("✅ Login: Tokens successfully stored")}catch(e){console.error("❌ Login: Failed to store tokens:",e)}return n(r.user),{success:!0,user:r.user}}catch(e){var s,r,a,l,c;if((null===(s=e.response)||void 0===s?void 0:s.status)===403&&(null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.requiresEmailVerification))return{success:!1,requiresEmailVerification:!0,message:e.response.data.message||"Please verify your email address before logging in."};return{success:!1,message:(null===(c=e.response)||void 0===c?void 0:null===(l=c.data)||void 0===l?void 0:l.message)||e.message||"Login failed"}}},d=async e=>{try{console.log("\uD83D\uDD10 Auth context: register called with:",e);let t={...e,userType:e.userType.toUpperCase()};console.log("\uD83D\uDD04 Auth context: calling authService.register with:",t);let o=await i.register(t);if(console.log("Auth service registration response:",o),o.requiresEmailVerification)return console.log("\uD83D\uDCE7 Registration requires email verification"),{success:!0,requiresEmailVerification:!0,message:o.message||"Registration successful! Please check your email to verify your account.",user:o.user};if(!o||!o.tokens||!o.tokens.accessToken)throw Error("Invalid registration response: missing tokens");if(!o.user)throw Error("Invalid registration response: missing user data");try{console.log("\uD83D\uDCBE Storing tokens in multiple storage locations..."),localStorage.setItem("token",o.tokens.accessToken),localStorage.setItem("refreshToken",o.tokens.refreshToken),sessionStorage.setItem("token",o.tokens.accessToken),sessionStorage.setItem("refreshToken",o.tokens.refreshToken),localStorage.setItem("localtalents_token",o.tokens.accessToken),localStorage.setItem("localtalents_refresh",o.tokens.refreshToken);let e=localStorage.getItem("token");localStorage.getItem("refreshToken");let t=sessionStorage.getItem("token"),s=localStorage.getItem("localtalents_token");if(console.log("\uD83D\uDD0D Token storage verification:",{localStorage:e?"SUCCESS":"FAILED",sessionStorage:t?"SUCCESS":"FAILED",prefixed:s?"SUCCESS":"FAILED"}),!e&&!t&&!s)throw Error("Failed to store tokens in any storage mechanism");console.log("✅ Tokens successfully stored and verified")}catch(e){throw console.error("❌ Failed to store tokens:",e),Error("Failed to store authentication tokens")}console.log("✅ Auth context: Tokens stored, setting user:",o.user);let s=localStorage.getItem("token"),r=localStorage.getItem("refreshToken");return console.log("\uD83D\uDD0D Stored tokens verification:",{accessToken:s?"EXISTS":"MISSING",refreshToken:r?"EXISTS":"MISSING"}),n(o.user),console.log("✅ Auth context: User set successfully:",o.user),console.log("\uD83D\uDD0D Auth context state after registration:",{user:o.user,hasTokens:!!s}),{success:!0,user:o.user,message:"Registration successful!"}}catch(e){var t,o,s,r,a;throw console.error("Auth context registration error:",e),console.error("Auth error response:",null===(t=e.response)||void 0===t?void 0:t.data),Error((null===(s=e.response)||void 0===s?void 0:null===(o=s.data)||void 0===o?void 0:o.message)||(null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.error)||e.message||"Registration failed")}},m=async()=>{try{await i.logout()}catch(e){console.error("Logout API call failed:",e)}finally{console.log("\uD83D\uDEAA Logout: Clearing all tokens and user state"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("token"),localStorage.removeItem("localtalents_accessToken"),localStorage.removeItem("localtalents_refreshToken"),sessionStorage.removeItem("token"),sessionStorage.removeItem("accessToken"),sessionStorage.removeItem("refreshToken"),n(null),console.log("✅ Logout: All tokens cleared, user state reset"),console.log("\uD83D\uDD04 Logout: Redirecting to login page"),g.push("/login")}},f=async()=>{try{let e=await i.refreshTokens();e.tokens&&(localStorage.setItem("token",e.tokens.accessToken),localStorage.setItem("refreshToken",e.tokens.refreshToken)),n(e.user)}catch(e){throw console.error("Token refresh failed:",e),await m(),e}},v=async e=>{try{let t=await i.verifyEmail(e);return t.tokens&&(localStorage.setItem("token",t.tokens.accessToken),localStorage.setItem("refreshToken",t.tokens.refreshToken),localStorage.setItem("localtalents_token",t.tokens.accessToken),localStorage.setItem("localtalents_refresh",t.tokens.refreshToken),sessionStorage.setItem("token",t.tokens.accessToken),n(t.user)),{success:!0,user:t.user,message:t.message||"Email verified successfully!"}}catch(e){var t,o;return{success:!1,message:(null===(o=e.response)||void 0===o?void 0:null===(t=o.data)||void 0===t?void 0:t.message)||e.message||"Email verification failed"}}},S=async e=>{try{let t=await i.resendVerification(e);return{success:!0,message:t.message||"Verification email sent successfully!"}}catch(e){var t,o;return{success:!1,message:(null===(o=e.response)||void 0===o?void 0:null===(t=o.data)||void 0===t?void 0:t.message)||e.message||"Failed to resend verification email"}}};return(0,s.jsx)(c.Provider,{value:{user:o,loading:l,login:k,register:d,logout:m,updateUser:e=>{},refreshAuth:f,verifyEmail:v,resendVerification:S},children:t})}function g(){let e=(0,r.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);